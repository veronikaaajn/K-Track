<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>K-Track ‚Äî Track your Kdrama Journey</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root{
      --primary: #16476A;
      --secondary: #80A1BA;
      --success: #FF5555;
      --danger: #BF1A1A;
      --bg-light: #ffffff;
      --bg-dark: #000000;
      --font-family: 'Poppins', sans-serif;
    }
    body{ font-family: var(--font-family); background: var(--bg-light); color: #0b1720; transition: background .25s, color .25s; }
    .navbar, .card { transition: background .25s, color .25s; }
    .brand { font-weight:700; color: var(--primary); }
    .tag-mood { background: rgba(12,24,36,0.06); border-radius: 12px; padding: 4px 8px; font-size: 12px; margin-right:6px; }
    .status-badge { font-size: 12px; }
    .progress { height: 8px; border-radius: 8px; }
    .card-img-top { height: 220px; object-fit: cover; border-radius: 8px; }

    /* Colors */
    .btn-primary-custom { background: var(--primary); border-color: var(--primary); }
    .btn-secondary-custom { background: var(--secondary); border-color: var(--secondary); color: #fff; }

    /* Dark mode */
    .dark-mode { background: var(--bg-dark); color: #e6eef4; }
    .dark-mode .navbar, .dark-mode .footer, .dark-mode .card { background: #07121a; color: #e6eef4; }
    .dark-mode .tag-mood { background: rgba(255,255,255,0.06); }
    .dark-mode .card-img-top { filter: brightness(.95); }

    /* Responsive tweaks */
    @media (max-width: 576px){
      .card-img-top { height: 160px; }
    }

    /* Watchlog columns */
    .watchcol { min-height: 280px; border: 1px dashed rgba(0,0,0,0.06); border-radius: 8px; padding: 12px; background: rgba(0,0,0,0.02); }
    .watchcol.dragover { border-color: var(--primary); background: rgba(12,70,100,0.04); }

    /* Playlist item */
    .playlist-item { padding: 8px; border-radius: 6px; margin-bottom: 6px; background: rgba(0,0,0,0.03); display:flex; align-items:center; gap:8px; }
    .playlist-item img{ width:46px; height:60px; object-fit:cover; border-radius:4px; }

    footer.footer { padding: 18px 0; border-top: 1px solid rgba(0,0,0,0.05); margin-top: 28px; }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="#">
        <img src="asset/logo.jpg" alt="logo" style="width:64px;height:64px;object-fit:cover;border-radius:8px;">
        <div>
          <div class="brand">K-Track</div>
          <small class="text-muted">Track your Kdrama Journey</small>
        </div>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navMain">
        <ul class="navbar-nav ms-auto me-3 mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link active" href="#" data-page="home">Home</a></li>
          <li class="nav-item"><a class="nav-link" href="#" data-page="watchlog">Watchlog</a></li>
          <li class="nav-item"><a class="nav-link" href="#" data-page="categories">Categories</a></li>
          <li class="nav-item"><a class="nav-link" href="#" data-page="reviews">Reviews</a></li>
          <li class="nav-item"><a class="nav-link" href="#" data-page="playlist">Playlist</a></li>
        </ul>

        <div class="d-flex align-items-center gap-2">
          <div class="input-group me-2" style="max-width:260px;">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input id="liveSearch" type="text" class="form-control" placeholder="Search drama..." />
          </div>

          <button id="themeToggle" class="btn btn-outline-secondary" title="Toggle dark/light">üåô</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main container -->
  <main class="container my-4">
    <!-- Pages wrapper -->
    <div id="pageHome" class="page">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Home</h3>
        <div>
          <select id="filterStatus" class="form-select form-select-sm d-inline-block" style="width:auto;">
            <option value="">All Status</option>
            <option value="Completed">Completed</option>
            <option value="Watching">Watching</option>
            <option value="Plan to Watch">Plan to Watch</option>
          </select>
          <select id="filterYear" class="form-select form-select-sm d-inline-block ms-2" style="width:auto;">
            <option value="">All Years</option>
          </select>
        </div>
      </div>

      <div id="cardsRow" class="row g-3">
        <!-- dynamically filled -->
      </div>
    </div>

    <!-- Watchlog -->
    <div id="pageWatchlog" class="page d-none">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <small class="text-muted">Drag & drop cards between columns to update status.</small>
      </div>

      <div class="row g-3">
        <div class="col-12 col-md-4">
          <h6>Watching <span class="badge bg-primary" id="countWatching">0</span></h6>
          <div id="colWatching" class="watchcol" data-status="Watching"></div>
        </div>
        <div class="col-12 col-md-4">
          <h6>Completed <span class="badge bg-success" id="countCompleted">0</span></h6>
          <div id="colCompleted" class="watchcol" data-status="Completed"></div>
        </div>
        <div class="col-12 col-md-4">
          <h6>Plan to Watch <span class="badge bg-secondary" id="countPlan">0</span></h6>
          <div id="colPlan" class="watchcol" data-status="Plan to Watch"></div>
        </div>
      </div>
    </div>

    <!-- Categories -->
    <div id="pageCategories" class="page d-none">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <select id="catYear" class="form-select form-select-sm" style="width:auto;">
            <option value="">-- Select Year --</option>
          </select>
        </div>
      </div>

      <div id="categoriesList" class="row g-3"></div>
    </div>

    <!-- Reviews -->
    <div id="pageReviews" class="page d-none">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Reviews</h3>
        <small class="text-muted">All personal reviews you've written.</small>
      </div>
      <div id="reviewsList" class="list-group"></div>
    </div>

    <!-- Playlist -->
    <div id="pagePlaylist" class="page d-none">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3>Playlist</h3>
        <div>
          <input id="newPlaylistName" class="form-control form-control-sm d-inline-block" placeholder="New playlist name" style="width:220px;" />
          <button id="createPlaylistBtn" class="btn btn-primary btn-sm ms-2">Create</button>
        </div>
      </div>

      <div class="row">
        <div class="col-12 col-md-5">
          <h6>Your Playlists</h6>
          <div id="playlistsContainer" class="list-group"></div>
        </div>
        <div class="col-12 col-md-7">
          <h6 id="playlistTitle">Select a playlist</h6>
          <div id="playlistItems" class="mt-2"></div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer bg-white">
    <div class="container d-flex justify-content-between align-items-center">
      <div>
        <small>Copyright ¬© 2025 K-Track</small>
      </div>
      <div>
        <button class="btn btn-link" data-bs-toggle="modal" data-bs-target="#aboutModal">About Developer</button>
      </div>
    </div>
  </footer>

  <!-- Detail / Edit Modal -->
  <div class="modal fade" id="detailModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="detailTitle">Drama Title</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-12 col-md-4">
              <img id="detailImage" src="" alt="" class="img-fluid rounded">
              <div class="mt-2">
                <div id="detailGenre" class="small text-muted"></div>
                <div id="detailYear" class="small text-muted"></div>
                <div id="detailEpisodes" class="small text-muted"></div>
              </div>
            </div>
            <div class="col-12 col-md-8">
              <div class="mb-2">
                <label class="form-label">Status</label>
                <select id="detailStatus" class="form-select">
                  <option>Watching</option>
                  <option>Completed</option>
                  <option>Plan to Watch</option>
                </select>
              </div>
              <div class="mb-2">
                <label class="form-label">Progress (episodes)</label>
                <div class="d-flex align-items-center gap-2">
                  <input id="detailProgress" type="number" min="0" class="form-control" style="width:110px;">
                  <div class="flex-grow-1"><div class="progress"><div id="detailProgressBar" class="progress-bar" style="width:0%"></div></div></div>
                </div>
              </div>

              <div class="mb-2">
                <label class="form-label">Rating (1-10)</label>
                <input id="detailRating" type="number" min="0" max="10" class="form-control" style="width:110px;">
              </div>

              <div class="mb-2">
                <label class="form-label">Review</label>
                <textarea id="detailReview" class="form-control" rows="5" placeholder="Write your review like a journal..."></textarea>
              </div>

              <div class="mb-2">
                <label class="form-label">Mood tags</label>
                <div id="detailMood" class="d-flex flex-wrap"></div>
              </div>

              <div class="d-flex gap-2 mt-3">
                <button id="saveDetailBtn" class="btn btn-primary-custom">Save</button>
                <button id="addToPlaylistBtn" class="btn btn-secondary-custom">Add to Playlist</button>
                <button class="btn btn-outline-danger" data-bs-dismiss="modal">Close</button>
              </div>

            </div>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- About Modal -->
  <div class="modal fade" id="aboutModal" tabindex="-1">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <h5>About Developer</h5>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <p><strong>Anyeong chingu! ‚ú®</strong></p>
          <p>Kenalin aku Veronika Jean Adinesa Putri, tapi cukup panggil Vero aja. Sekarang aku kuliah di Universitas Sugeng Hartono, jurusan Bisnis Digital semester 5 (NIM 062302081).</p>
            <p>Aku lumayan suka hal hal yang berbau desain jadi Selamat datang di halaman proyekku!</p>
            <p>K-Track ku ini lahir dari sebuah hobi kecil yang terkadang jadi healing spot kalo lagi suntuk yaitu nonton K-Drama. Aku ingin kalian yang punya hobi sama bisa punya tempat yang simple, rapi, dan menyenangkan buat ngetrack semua tontonan kalian.</p>
            <p>Semoga kalian merasa ditemani di sini ü§ç</p>
          <p>Find me on:</p>
          <ul>
            <li>Instagram: <a href="https://instagram.com/veronikaaajn" target="_blank">@veronikaaajn</a></li>
            <li>TikTok: <a href="https://tiktok.com/@veroonikaaajn" target="_blank">@veroonikaaajn</a></li>
            <li>YouTube: <a href="https://youtube.com/@Veronikaaajn" target="_blank">Veronikaaajn</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap + Icons + JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.js"></script>

  <script>
    /* -----------------------
       Initial Data
       ----------------------- */
    const sampleDrama = [
      // 2025 (use gambar1..)
      { id:1, title:"The Trauma Code: Heroes On Call", year:2025, genre:"Medical, Drama", episodes:12, status:"Completed", progress:12, rating:8, review:"Mengharukan & penuh aksi. Penampilan yang kuat.", mood:["tense","inspirational"], img:"asset/gambar1.jpg"},
      { id:2, title:"Bon App√©tit, Your Majesty", year:2025, genre:"Romance, Comedy", episodes:10, status:"Completed", progress:10, rating:7, review:"Manis dan lucu, chemistry menarik.", mood:["romantic","cute"], img:"asset/gambar2.jpg"},
      { id:3, title:"Newtopia", year:2025, genre:"Sci-Fi, Thriller", episodes:8, status:"Completed", progress:8, rating:8, review:"Konsep unik, pacing cepat.", mood:["mysterious"], img:"asset/gambar3.jpg"},
      { id:4, title:"Confidence Queen", year:2025, genre:"Drama, Comedy", episodes:16, status:"Completed", progress:16, rating:7, review:"Feel-good empowering story.", mood:["uplifting"], img:"asset/gambar4.jpg"},
      { id:5, title:"The Witch", year:2025, genre:"Fantasy, Mystery", episodes:12, status:"Completed", progress:12, rating:8, review:"Estetika gelap dan plot memikat.", mood:["dark","mystic"], img:"asset/gambar5.jpg"},
      { id:6, title:"Undercover High School", year:2025, genre:"Action, School", episodes:14, status:"Completed", progress:14, rating:7, review:"Seru dan cepat.", mood:["action"], img:"asset/gambar6.jpg"},
      { id:7, title:"Resident Playbook", year:2025, genre:"Sports, Drama", episodes:10, status:"Completed", progress:10, rating:7, review:"Hangat dan kompetitif.", mood:["sporty"], img:"asset/gambar7.jpg"},
      { id:8, title:"Head Over Heels", year:2025, genre:"Romance, Comedy", episodes:12, status:"Completed", progress:12, rating:6, review:"Romcom klasik.", mood:["romantic","fun"], img:"asset/gambar8.jpg"},
      { id:9, title:"Salon de Holmes", year:2025, genre:"Mystery, Comedy", episodes:8, status:"Completed", progress:8, rating:7, review:"Unik & quirky.", mood:["quirky"], img:"asset/gambar9.jpg"},
      { id:10, title:"Bitch and Rich 2", year:2025, genre:"Drama", episodes:16, status:"Completed", progress:16, rating:6, review:"Drama keluarga kelanjutan.", mood:["drama"], img:"asset/gambar10.jpg"},
      { id:11, title:"Genie, Make a Wish", year:2025, genre:"Fantasy, Romance", episodes:12, status:"Completed", progress:12, rating:7, review:"Hangat, berfantasi.", mood:["whimsical"], img:"asset/gambar11.jpg"},
      { id:12, title:"Would You Marry Me", year:2025, genre:"Romance, Drama", episodes:10, status:"Completed", progress:10, rating:6, review:"Sentimental.", mood:["romantic"], img:"asset/gambar12.jpg"},
      { id:13, title:"The Winning Try", year:2025, genre:"Sports, Drama", episodes:16, status:"Completed", progress:16, rating:7, review:"Inspiratif.", mood:["motivating"], img:"asset/gambar13.jpg"},
      { id:14, title:"The Potato Lab", year:2025, genre:"Slice of Life, Comedy", episodes:8, status:"Watching", progress:2, rating:0, review:"", mood:["cozy"], img:"asset/gambar14.jpg"},
      { id:15, title:"Mercy for None", year:2025, genre:"Crime, Thriller", episodes:10, status:"Watching", progress:1, rating:0, review:"", mood:["tense"], img:"asset/gambar15.jpg"},
      { id:16, title:"Beyond the Bar", year:2025, genre:"Drama, Music", episodes:12, status:"Watching", progress:3, rating:0, review:"", mood:["emotional"], img:"asset/gambar16.jpg"},

      // 2024
      { id:17, title:"Flex x Cop", year:2024, genre:"Action, Comedy", episodes:12, status:"Completed", progress:12, rating:7, review:"Entertaining.", mood:["fun"], img:"asset/gambar17.jpg"},
      { id:18, title:"The Judge from Hell", year:2024, genre:"Fantasy, Thriller", episodes:10, status:"Completed", progress:10, rating:8, review:"Unik & gelap.", mood:["mystic"], img:"asset/gambar18.jpg"},
      { id:19, title:"Queen of Tears", year:2024, genre:"Drama, Romance", episodes:16, status:"Completed", progress:16, rating:9, review:"Emosional & hebat.", mood:["dramatic"], img:"asset/gambar19.jpg"},
      { id:20, title:"Seoul Busters", year:2024, genre:"Action", episodes:12, status:"Completed", progress:12, rating:7, review:"Aksi seru.", mood:["action"], img:"asset/gambar20.jpg"},
      { id:21, title:"Hierarchy", year:2024, genre:"Drama", episodes:10, status:"Completed", progress:10, rating:6, review:"Intense.", mood:["serious"], img:"asset/gambar21.jpg"},
      { id:22, title:"A Shop for Killers", year:2024, genre:"Thriller", episodes:8, status:"Watching", progress:1, rating:0, review:"", mood:["dark"], img:"asset/gambar22.jpg"},

      // 2023
      { id:23, title:"King the Land", year:2023, genre:"Romance, Comedy", episodes:16, status:"Completed", progress:16, rating:7, review:"Light & fun.", mood:["romantic"], img:"asset/gambar23.jpg"},
      { id:24, title:"Celebrity", year:2023, genre:"Drama", episodes:12, status:"Completed", progress:12, rating:8, review:"Sharp commentary.", mood:["edgy"], img:"asset/gambar24.jpg"},
      { id:25, title:"Daily Dose of Sunshine", year:2023, genre:"Slice of Life", episodes:10, status:"Completed", progress:10, rating:8, review:"Heartwarming.", mood:["cozy"], img:"asset/gambar25.jpg"},

      // 2022
      { id:26, title:"Ghost Doctor", year:2022, genre:"Fantasy, Medical", episodes:12, status:"Completed", progress:12, rating:7, review:"Funny & creepy.", mood:["weird"], img:"asset/gambar26.jpg"},
      { id:27, title:"All of Us Are Dead", year:2022, genre:"Horror, Thriller", episodes:12, status:"Completed", progress:12, rating:8, review:"Intense survival.", mood:["scary"], img:"asset/gambar27.jpg"},
      { id:28, title:"Forecasting Love and Weather", year:2022, genre:"Romance", episodes:16, status:"Completed", progress:16, rating:8, review:"Sweet romance.", mood:["romantic"], img:"asset/gambar28.jpg"},
      { id:29, title:"A Business Proposal", year:2022, genre:"Romance, Comedy", episodes:12, status:"Completed", progress:12, rating:8, review:"Classic romcom.", mood:["fun"], img:"asset/gambar29.jpg"},
      { id:30, title:"Thirty-Nine", year:2022, genre:"Drama", episodes:12, status:"Plan to Watch", progress:0, rating:0, review:"", mood:[], img:"asset/gambar30.jpg"},
      { id:31, title:"Military Prosecutor Doberman", year:2022, genre:"Action, Legal", episodes:14, status:"Plan to Watch", progress:0, rating:0, review:"", mood:[], img:"asset/gambar31.jpg"},
      { id:32, title:"Soundtrack #1", year:2022, genre:"Romance, Music", episodes:8, status:"Completed", progress:8, rating:7, review:"Gentle & musical.", mood:["soft"], img:"asset/gambar32.jpg"},
      { id:33, title:"Our Blues", year:2022, genre:"Drama", episodes:16, status:"Plan to Watch", progress:0, rating:0, review:"", mood:[], img:"asset/gambar33.jpg"},
      { id:34, title:"Sh**ting Stars", year:2022, genre:"Romance, Comedy", episodes:16, status:"Completed", progress:16, rating:6, review:"Entertaining.", mood:["fun"], img:"asset/gambar34.jpg"},
      { id:35, title:"Woori the Virgin", year:2022, genre:"Romance, Comedy", episodes:16, status:"Completed", progress:16, rating:7, review:"Sweet remake.", mood:["romantic"], img:"asset/gambar35.jpg"},
      { id:36, title:"The Sound of Magic", year:2022, genre:"Fantasy, Musical", episodes:6, status:"Watching", progress:2, rating:0, review:"", mood:["magical"], img:"asset/gambar36.jpg"},
      { id:37, title:"If You Wish Upon Me", year:2022, genre:"Drama", episodes:12, status:"Completed", progress:12, rating:7, review:"Emotional.", mood:["emotional"], img:"asset/gambar37.jpg"},
      { id:38, title:"Little Women", year:2022, genre:"Drama", episodes:12, status:"Completed", progress:12, rating:8, review:"Powerful.", mood:["intense"], img:"asset/gambar38.jpg"},
      { id:39, title:"One Dollar Lawyer", year:2022, genre:"Comedy, Legal", episodes:16, status:"Completed", progress:16, rating:7, review:"Clever & quick.", mood:["funny"], img:"asset/gambar39.jpg"},
      { id:40, title:"Love in Contract", year:2022, genre:"Romance, Comedy", episodes:12, status:"Completed", progress:12, rating:7, review:"Comforting romcom.", mood:["cozy"], img:"asset/gambar40.jpg"},
      { id:41, title:"Cheer Up", year:2022, genre:"School, Sports", episodes:10, status:"Completed", progress:10, rating:6, review:"Energetic.", mood:["sporty"], img:"asset/gambar41.jpg"},
      { id:42, title:"The First Responders", year:2022, genre:"Action, Drama", episodes:12, status:"Plan to Watch", progress:0, rating:0, review:"", mood:[], img:"asset/gambar42.jpg"},
      { id:43, title:"Rookie Cops", year:2022, genre:"School, Drama", episodes:12, status:"Completed", progress:12, rating:7, review:"Young & fresh.", mood:["youthful"], img:"asset/gambar43.jpg"},
    ];

    /* -----------------------
       Storage & Initialization
       ----------------------- */
    const STORAGE_KEY = 'ktrack_data_v1';
    const THEME_KEY = 'ktrack_theme_v1';
    const PLAYLIST_KEY = 'ktrack_playlists_v1';

    function loadData(){
      const raw = localStorage.getItem(STORAGE_KEY);
      if(raw) return JSON.parse(raw);
      // clone sample
      localStorage.setItem(STORAGE_KEY, JSON.stringify(sampleDrama));
      return JSON.parse(localStorage.getItem(STORAGE_KEY));
    }
    function saveData(data){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    }

    let dramas = loadData();
    let playlists = JSON.parse(localStorage.getItem(PLAYLIST_KEY) || "[]");
    let currentPlaylistId = null;

    /* -----------------------
       Utilities
       ----------------------- */
    function byId(id){ return dramas.find(d => d.id === id); }
    function persist(){ saveData(dramas); renderAll(); }

    /* -----------------------
       Render Functions
       ----------------------- */
    const cardsRow = document.getElementById('cardsRow');
    function renderHome(filterText='', statusFilter='', yearFilter=''){
      cardsRow.innerHTML = '';
      const query = filterText.trim().toLowerCase();
      const data = dramas.filter(d => {
        if(statusFilter && d.status !== statusFilter) return false;
        if(yearFilter && String(d.year) !== String(yearFilter)) return false;
        if(!query) return true;
        return (d.title + ' ' + d.genre + ' ' + d.year).toLowerCase().includes(query);
      });

      data.forEach(d => {
        const col = document.createElement('div');
        col.className = 'col-12 col-sm-6 col-md-4 col-lg-3';
        col.innerHTML = `
          <div class="card h-100 shadow-sm">
            <img src="${d.img}" class="card-img-top" alt="${escapeHtml(d.title)}">
            <div class="card-body d-flex flex-column">
              <h6 class="card-title mb-1">${escapeHtml(d.title)}</h6>
              <div class="mb-1 small text-muted">${d.genre} ‚Ä¢ ${d.year}</div>
              <div class="mb-2">
                <span class="badge status-badge ${d.status==='Completed' ? 'bg-success' : d.status==='Watching' ? 'bg-primary' : 'bg-secondary'}">${d.status}</span>
                <span class="ms-2 small text-muted">Episodes: ${d.episodes}</span>
              </div>
              <div class="mb-2">
                <div class="progress"><div class="progress-bar" role="progressbar" style="width:${ Math.round((d.progress/d.episodes)*100) }%"></div></div>
                <small class="text-muted">${d.progress}/${d.episodes} eps</small>
              </div>
              <p class="card-text text-truncate">${d.review || '<em>No review yet</em>'}</p>
              <div class="mt-auto d-flex justify-content-between align-items-center">
                <div>
                  <button class="btn btn-sm btn-outline-primary btn-detail" data-id="${d.id}">Details</button>
                </div>
                <div>
                  <span class="fst-italic small">${d.rating ? d.rating+'/10' : ''}</span>
                </div>
              </div>
            </div>
          </div>
        `;
        cardsRow.appendChild(col);
      });

      // populate year filter dropdowns
      populateYearFilters();
      attachDetailButtons();
    }

    function renderWatchlog(){
      const cWatch = document.getElementById('colWatching');
      const cComp = document.getElementById('colCompleted');
      const cPlan = document.getElementById('colPlan');
      cWatch.innerHTML=''; cComp.innerHTML=''; cPlan.innerHTML='';

      dramas.forEach(d => {
        const node = createWatchCard(d);
        if(d.status==='Watching') cWatch.appendChild(node);
        else if(d.status==='Completed') cComp.appendChild(node);
        else cPlan.appendChild(node);
      });

      document.getElementById('countWatching').textContent = dramas.filter(d=>d.status==='Watching').length;
      document.getElementById('countCompleted').textContent = dramas.filter(d=>d.status==='Completed').length;
      document.getElementById('countPlan').textContent = dramas.filter(d=>d.status==='Plan to Watch').length;

      enableDragDropWatchlog();
      attachDetailButtons();
    }

    function renderCategories(yearSelected=''){
      const container = document.getElementById('categoriesList');
      container.innerHTML='';
      const list = dramas.filter(d => !yearSelected || String(d.year)===String(yearSelected));
      if(!list.length){
        container.innerHTML = `<div class="col-12"><div class="alert alert-light">No dramas found for selected year.</div></div>`;
        return;
      }
      list.forEach(d => {
        const col = document.createElement('div');
        col.className = 'col-12 col-md-6 col-lg-4';
        col.innerHTML = `
          <div class="card shadow-sm">
            <div class="row g-0">
              <div class="col-4"><img src="${d.img}" class="img-fluid rounded-start" style="height:120px;object-fit:cover;"></div>
              <div class="col-8">
                <div class="card-body p-2">
                  <h6 class="mb-1">${escapeHtml(d.title)}</h6>
                  <small class="text-muted">${d.genre}</small>
                  <div class="mt-2">
                    <span class="badge ${d.status==='Completed'?'bg-success':d.status==='Watching'?'bg-primary':'bg-secondary'}">${d.status}</span>
                    <div class="mt-1 small text-muted">${d.progress}/${d.episodes} eps</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        `;
        container.appendChild(col);
      });
      populateCatYearSelect();
      attachDetailButtons();
    }

    function renderReviews(){
      const container = document.getElementById('reviewsList');
      container.innerHTML = '';
      const list = dramas.filter(d => d.review && d.review.trim().length > 0);
      if(!list.length) container.innerHTML = `<div class="alert alert-light">No reviews yet. Write one from a drama's detail page!</div>`;
      list.forEach(d=>{
        const item = document.createElement('div');
        item.className = 'list-group-item';
        item.innerHTML = `
          <div class="d-flex w-100 justify-content-between">
            <h6 class="mb-1">${escapeHtml(d.title)} <small class="text-muted">(${d.year})</small></h6>
            <small>${d.rating ? d.rating+'/10' : ''}</small>
          </div>
          <p class="mb-1">${escapeHtml(d.review)}</p>
          <div class="d-flex gap-2">
            <button class="btn btn-sm btn-outline-primary btn-detail" data-id="${d.id}">Open</button>
            <button class="btn btn-sm btn-outline-danger btn-delete-review" data-id="${d.id}">Delete Review</button>
          </div>
        `;
        container.appendChild(item);
      });
      attachDetailButtons();
      container.querySelectorAll('.btn-delete-review').forEach(b=>{
        b.addEventListener('click', (e)=>{
          const id = Number(e.target.dataset.id);
          const d = byId(id);
          if(!d) return;
          if(confirm('Delete review?')){ d.review=''; d.rating=0; persist(); }
        });
      });
    }

    /* -----------------------
       Watchlog card creation & drag drop
       ----------------------- */
    function createWatchCard(d){
      const div = document.createElement('div');
      div.className = 'card mb-2 shadow-sm';
      div.draggable = true;
      div.dataset.id = d.id;
      div.innerHTML = `
        <div class="card-body d-flex gap-2 align-items-center">
          <img src="${d.img}" style="width:56px;height:72px;object-fit:cover;border-radius:6px;">
          <div class="flex-grow-1">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <strong>${escapeHtml(d.title)}</strong>
                <div class="small text-muted">${d.genre}</div>
              </div>
              <div><span class="badge ${d.status==='Completed'?'bg-success':d.status==='Watching'?'bg-primary':'bg-secondary'}">${d.status}</span></div>
            </div>
            <div class="mt-2">
              <div class="progress"><div class="progress-bar" style="width:${Math.round((d.progress/d.episodes)*100)}%"></div></div>
              <small class="text-muted">${d.progress}/${d.episodes} eps</small>
            </div>
          </div>
          <div>
            <button class="btn btn-sm btn-outline-primary btn-detail" data-id="${d.id}">Detail</button>
          </div>
        </div>
      `;
      return div;
    }

    function enableDragDropWatchlog(){
      const cols = document.querySelectorAll('.watchcol');
      let dragged = null;
      document.querySelectorAll('.watchcol .card').forEach(card=>{
        card.addEventListener('dragstart', (e)=> {
          dragged = card;
          e.dataTransfer.setData('text/plain', card.dataset.id);
          setTimeout(()=>card.style.opacity = '0.5', 50);
        });
        card.addEventListener('dragend',(e)=> card.style.opacity='1');
      });

      cols.forEach(col=>{
        col.addEventListener('dragover', (e)=> { e.preventDefault(); col.classList.add('dragover'); });
        col.addEventListener('dragleave', ()=> col.classList.remove('dragover'));
        col.addEventListener('drop', (e)=>{
          e.preventDefault(); col.classList.remove('dragover');
          const id = Number(e.dataTransfer.getData('text/plain') || (dragged && dragged.dataset.id));
          if(!id) return;
          const targetStatus = col.dataset.status;
          const d = byId(id);
          if(d){
            d.status = targetStatus;
            // if completed, set progress to full
            if(targetStatus === 'Completed') d.progress = d.episodes;
            if(targetStatus === 'Plan to Watch') d.progress = 0;
            persist();
          }
        });
      });
    }

    /* -----------------------
       Detail Modal interactions
       ----------------------- */
    const detailModalEl = document.getElementById('detailModal');
    const detailModal = new bootstrap.Modal(detailModalEl);
    let currentDetailId = null;

    function attachDetailButtons(){
      document.querySelectorAll('.btn-detail').forEach(b=>{
        b.onclick = () => {
          const id = Number(b.dataset.id);
          openDetail(id);
        };
      });
    }

    function openDetail(id){
      currentDetailId = id;
      const d = byId(id);
      if(!d) return;
      document.getElementById('detailTitle').textContent = d.title;
      document.getElementById('detailImage').src = d.img;
      document.getElementById('detailGenre').textContent = d.genre;
      document.getElementById('detailYear').textContent = 'Year: ' + d.year;
      document.getElementById('detailEpisodes').textContent = 'Episodes: ' + d.episodes;
      document.getElementById('detailStatus').value = d.status;
      document.getElementById('detailProgress').value = d.progress;
      updateDetailProgressBar(d);
      document.getElementById('detailRating').value = d.rating || '';
      document.getElementById('detailReview').value = d.review || '';
      renderMoodTags('detailMood', d.mood || []);
      detailModal.show();
    }

    function updateDetailProgressBar(d){
      const percent = d.episodes ? Math.round((d.progress/d.episodes)*100) : 0;
      const bar = document.getElementById('detailProgressBar');
      bar.style.width = percent + '%';
      bar.textContent = percent + '%';
    }

    document.getElementById('detailProgress').addEventListener('input', (e)=>{
      const val = Number(e.target.value || 0);
      const d = byId(currentDetailId);
      if(!d) return;
      if(val > d.episodes) e.target.value = d.episodes;
      d.progress = Math.max(0, Math.min(d.episodes, val));
      updateDetailProgressBar(d);
    });

    document.getElementById('saveDetailBtn').addEventListener('click', ()=>{
      const d = byId(currentDetailId);
      if(!d) return;
      d.status = document.getElementById('detailStatus').value;
      d.progress = Number(document.getElementById('detailProgress').value || 0);
      d.rating = Number(document.getElementById('detailRating').value || 0);
      d.review = document.getElementById('detailReview').value;
      persist();
      detailModal.hide();
    });

    document.getElementById('addToPlaylistBtn').addEventListener('click', ()=>{
      if(playlists.length === 0){
        alert('Create a playlist first in Playlist tab.');
        return;
      }
      const name = playlists[0].name;
      const pid = playlists[0].id;
      const d = byId(currentDetailId);
      if(!d) return;
      if(!playlists[0].items.includes(d.id)) playlists[0].items.push(d.id);
      localStorage.setItem(PLAYLIST_KEY, JSON.stringify(playlists));
      alert('Added to playlist: ' + name);
    });

    function renderMoodTags(containerId, tags){
      const el = document.getElementById(containerId);
      el.innerHTML = '';
      (tags || []).forEach(t=>{
        const span = document.createElement('span');
        span.className = 'tag-mood';
        span.textContent = t;
        el.appendChild(span);
      });
    }

    /* -----------------------
       Playlist Handling (drag reorder)
       ----------------------- */
    function renderPlaylists(){
      const cont = document.getElementById('playlistsContainer');
      cont.innerHTML = '';
      if(playlists.length === 0){
        cont.innerHTML = '<div class="text-muted small">No playlists yet. Create one on the right.</div>';
        document.getElementById('playlistTitle').textContent = 'Select a playlist';
        document.getElementById('playlistItems').innerHTML = '';
        return;
      }
      playlists.forEach(pl=>{
        const a = document.createElement('a');
        a.className = 'list-group-item list-group-item-action';
        a.href = '#';
        a.dataset.id = pl.id;
        a.innerHTML = `<div class="d-flex justify-content-between align-items-center"><div>${escapeHtml(pl.name)}</div><div><span class="badge bg-secondary">${pl.items.length}</span></div></div>`;
        a.onclick = (e)=>{ e.preventDefault(); selectPlaylist(pl.id); };
        cont.appendChild(a);
      });
      if(!currentPlaylistId) selectPlaylist(playlists[0].id);
    }

    function selectPlaylist(id){
      currentPlaylistId = id;
      const pl = playlists.find(p=>p.id===id);
      if(!pl) return;
      document.getElementById('playlistTitle').textContent = `Playlist: ${pl.name}`;
      const itemsDiv = document.getElementById('playlistItems');
      itemsDiv.innerHTML = '';
      if(pl.items.length === 0) itemsDiv.innerHTML = '<div class="small text-muted">No items. Add from drama detail.</div>';
      pl.items.forEach((did, idx)=>{
        const d = byId(did);
        if(!d) return;
        const div = document.createElement('div');
        div.className = 'playlist-item';
        div.draggable = true;
        div.dataset.index = idx;
        div.dataset.plid = id;
        div.innerHTML = `<img src="${d.img}"><div class="flex-grow-1">${escapeHtml(d.title)} <div class="small text-muted">${d.genre}</div></div><div><button class="btn btn-sm btn-outline-danger btn-remove" data-index="${idx}">Remove</button></div>`;
        itemsDiv.appendChild(div);
      });

      // attach remove
      itemsDiv.querySelectorAll('.btn-remove').forEach(btn=>{
        btn.addEventListener('click', (e)=>{
          const idx = Number(e.target.dataset.index);
          pl.items.splice(idx,1);
          localStorage.setItem(PLAYLIST_KEY, JSON.stringify(playlists));
          renderPlaylists();
        });
      });

      enableDragSortPlaylist(itemsDiv, pl);
    }

    function enableDragSortPlaylist(container, pl){
      let draggingEl = null, startIndex = null;
      container.querySelectorAll('.playlist-item').forEach(item=>{
        item.addEventListener('dragstart', (e)=>{
          draggingEl = item;
          startIndex = Number(item.dataset.index);
          e.dataTransfer.effectAllowed = 'move';
          setTimeout(()=> item.style.opacity = '0.5', 50);
        });
        item.addEventListener('dragend', ()=> { if(item) item.style.opacity='1'; });
      });

      container.addEventListener('dragover', (e)=> { e.preventDefault(); });
      container.addEventListener('drop', (e)=>{
        e.preventDefault();
        const target = e.target.closest('.playlist-item');
        if(!target || !draggingEl) return;
        const toIndex = Number(target.dataset.index);
        // reorder pl.items
        const moved = pl.items.splice(startIndex,1)[0];
        pl.items.splice(toIndex,0,moved);
        localStorage.setItem(PLAYLIST_KEY, JSON.stringify(playlists));
        renderPlaylists();
      });
    }

    document.getElementById('createPlaylistBtn').addEventListener('click', ()=>{
      const name = document.getElementById('newPlaylistName').value.trim();
      if(!name) return alert('Enter playlist name');
      const id = Date.now();
      playlists.unshift({ id, name, items: [] });
      localStorage.setItem(PLAYLIST_KEY, JSON.stringify(playlists));
      document.getElementById('newPlaylistName').value='';
      renderPlaylists();
    });

    /* -----------------------
       Filters & search
       ----------------------- */
    document.getElementById('liveSearch').addEventListener('input', (e)=>{
      const q = e.target.value;
      const status = document.getElementById('filterStatus').value;
      const year = document.getElementById('filterYear').value;
      renderHome(q, status, year);
    });
    document.getElementById('filterStatus').addEventListener('change', (e)=>{
      renderHome(document.getElementById('liveSearch').value, e.target.value, document.getElementById('filterYear').value);
    });
    document.getElementById('filterYear').addEventListener('change', (e)=>{
      renderHome(document.getElementById('liveSearch').value, document.getElementById('filterStatus').value, e.target.value);
    });

    function populateYearFilters(){
      const years = Array.from(new Set(dramas.map(d=>d.year))).sort((a,b)=>b-a);
      const sel = document.getElementById('filterYear');
      const sel2 = document.getElementById('catYear');
      sel.innerHTML = '<option value="">All Years</option>';
      sel2.innerHTML = '<option value="">-- Select Year --</option>';
      years.forEach(y=>{
        sel.innerHTML += `<option value="${y}">${y}</option>`;
        sel2.innerHTML += `<option value="${y}">${y}</option>`;
      });
    }
    document.getElementById('catYear').addEventListener('change', (e)=>{
      renderCategories(e.target.value);
    });
    function populateCatYearSelect(){
      // keeps same as populateYearFilters
      populateYearFilters();
    }

    /* -----------------------
       Navigation
       ----------------------- */
    document.querySelectorAll('[data-page]').forEach(a=>{
      a.addEventListener('click', (e)=>{
        e.preventDefault();
        const page = a.dataset.page;
        showPage(page);
        document.querySelectorAll('.nav-link').forEach(n=>n.classList.remove('active'));
        a.classList.add('active');
      });
    });

    function showPage(page){
      document.querySelectorAll('.page').forEach(p=>p.classList.add('d-none'));
      document.getElementById('pageHome').classList.add('d-none');
      if(page === 'home'){ document.getElementById('pageHome').classList.remove('d-none'); renderHome(document.getElementById('liveSearch').value, document.getElementById('filterStatus').value, document.getElementById('filterYear').value); }
      if(page === 'watchlog'){ document.getElementById('pageWatchlog').classList.remove('d-none'); renderWatchlog(); }
      if(page === 'categories'){ document.getElementById('pageCategories').classList.remove('d-none'); renderCategories(); }
      if(page === 'reviews'){ document.getElementById('pageReviews').classList.remove('d-none'); renderReviews(); }
      if(page === 'playlist'){ document.getElementById('pagePlaylist').classList.remove('d-none'); renderPlaylists(); }
    }

    /* -----------------------
       Theme (dark/light)
       ----------------------- */
    const themeToggle = document.getElementById('themeToggle');
    function applyTheme(theme){
      if(theme === 'dark'){
        document.body.classList.add('dark-mode');
        themeToggle.textContent = '‚òÄÔ∏è';
      } else {
        document.body.classList.remove('dark-mode');
        themeToggle.textContent = 'üåô';
      }
      localStorage.setItem(THEME_KEY, theme);
    }
    themeToggle.addEventListener('click', ()=>{
      const cur = localStorage.getItem(THEME_KEY) || 'light';
      applyTheme(cur === 'light' ? 'dark' : 'light');
    });

    /* -----------------------
       Helpers
       ----------------------- */
    function escapeHtml(text){
      if(!text) return '';
      return text.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;');
    }

    /* -----------------------
       Initial render
       ----------------------- */
    function renderAll(){
      // re-read data
      dramas = loadData();
      renderHome();
      // if some page currently visible, re-render it
      const visible = document.querySelector('.page:not(.d-none)');
      if(visible){
        const id = visible.id;
        if(id === 'pageWatchlog') renderWatchlog();
        if(id === 'pageCategories') renderCategories();
        if(id === 'pageReviews') renderReviews();
        if(id === 'pagePlaylist') renderPlaylists();
      }
    }

    // Initialize theme
    const savedTheme = localStorage.getItem(THEME_KEY) || 'light';
    applyTheme(savedTheme);

    // initial page
    renderAll();
    showPage('home');

    // populate dropdown options for filters
    populateYearFilters();

    /* -----------------------
       Small UX improvements
       ----------------------- */
    // keyboard: press "/" to focus search
    window.addEventListener('keydown', (e)=>{
      if(e.key === '/' && document.activeElement.tagName !== 'INPUT' && document.activeElement.tagName !== 'TEXTAREA'){
        e.preventDefault();
        document.getElementById('liveSearch').focus();
      }
    });

    // small safety: save any manual progress changes on input blur
    document.getElementById('detailProgress').addEventListener('blur', ()=>{
      const d = byId(currentDetailId);
      if(d) { d.progress = Number(document.getElementById('detailProgress').value || 0); persist(); }
    });

    // on startup, ensure playlists var from storage
    try{
      playlists = JSON.parse(localStorage.getItem(PLAYLIST_KEY) || "[]");
    }catch(e){ playlists = []; }

    // ensure images exist ‚Äî if not, ignore silently (user should provide assets)
    // No extra action needed.

  </script>
</body>
</html>
